---
layout: default
title: 🧩하드웨어 구성
nav_order: 6
parent: 🛠 개발 가이드
description: "살가이 프로젝트 하드웨어 개발 가이드"
permalink: /documents/developments/hardware/
---

# 🧩 하드웨어 구성

![하드웨어 배선도](/assets/images/하드웨어배선도.png)

살가이 프로젝트의 하드웨어는 **라즈베리파이 5**를 기반으로 한 단일 디바이스로, 고령의 사용자가 직접 대면하게 되는 **AI 스피커 형태의 인터페이스**입니다.  
이 장치는 음성 기반 복약 확인 시스템의 물리적 인터페이스를 구성하며, 추상화를 위해 상호작용 중심의 기능을 **온전히 서버에서 처리**하도록 설계되어 있습니다.

---

## 사용된 장비

- **🧠 라즈베리파이 5**  
  전체 하드웨어 제어 및 음성 인터페이스 실행. 복약 알림, 녹음, 음성 피드백, 등을 모두 담당합니다.

- **🔊 스피커**  
  서버로부터 받은 TTS 음성 파일을 재생하여 사용자에게 피드백을 제공합니다.

- **🎤 마이크**  
  사용자의 음성을 녹음하여 STT 처리를 위한 WAV 파일을 생성합니다. Wake Word 감지 루틴과 복약 응답 루틴에서 모두 활용됩니다.

- **🔴 LED (상태 시각화용)**  
  복약 루틴 또는 음성 처리 과정의 상태를 사용자에게 시각적으로 전달하기 위해 컬러 LED를 사용합니다.
  
  | 상태 | 색상 | 의미 |
  |------|------|------|
  | 대기 | OFF | 아무 동작 없음 |
  | 녹음/출력 | 파랑(B) | 음성 입출력 중 |
  | 판단 중 | 초록(G) | AI 분석 진행 중 |
  | 오류 | 빨강(R) | 처리 중 오류 발생 |

- **🖥 디스플레이**  
  복약 알림, 현재 시각, 피드백 메시지 등을 표시하는 시각적 출력 장치로, UI는 키오스크 형태로 구성됩니다. 스피커의 UI는 React 기반의 웹 페이지로 구현되어 라즈베리파이에 연결할 필요 없이 외부 디스플레이를 사용하는 것도 가능합니다.  

- **🔘 버튼 (선택적)**  
  음성 인터페이스 사용이 어려운 경우를 대비하여 물리적 버튼으로 알림 확인이나 녹음 종료 트리거를 줄 수 있습니다.

---

## 하드웨어 구성의 핵심 원칙

1. **고령자 사용성 중심 설계**  
   - 버튼, 음성, LED, 화면 등 다양한 피드백 채널을 활용해 사용자의 이해를 돕습니다.
   - 음성 인식 실패나 무응답 상황에 대비해 **시각적 피드백과 물리 버튼**을 병행 지원합니다.

2. **로컬에서 경량 동작**  
   - STT, TTS, LLM 처리는 서버에서 담당하고, 라즈베리파이는 오직 녹음, 전송, 재생 루틴만 처리합니다.
   - 복잡한 연산을 서버로 위임함으로써 하드웨어 부담을 최소화하고 발열·속도 문제를 방지합니다.


---

## Wake Word 감지

- Wake Word는 `pvporcupine` 라이브러리를 사용하여 "살가이"라는 음성을 로컬에서 실시간 감지합니다.
- 이를 통해 사용자는 버튼 없이도 음성으로 장치를 깨우고 대화를 시작할 수 있습니다.

---

## 마이크 충돌 해결

- Wake Word 루틴과 녹음 루틴은 서로 다른 쓰레드로 실행되며, **ALSA 장치 사용 충돌을 방지하기 위해 `mic_lock`**을 구현했습니다.
- Wake Word 감지 루틴은 잠시 마이크 점유를 해제하고, 녹음이 끝난 뒤 재시작됩니다.

---

## 💡 사용성 예시

- **복약 전**  
  🔈 "살가이, 지금 몇 시야?"  
  📺 디스플레이 및 스피커: `지금은 오전 8시 57분입니다.`

- **복약 시간 도달 시**  
  🔔 알림: "아침 약 드실 시간이에요. 식사하셨나요?"  
  🔴 LED: 파랑 → 초록  
  📤 녹음 후 전송

- **결과 피드백**  
  🔈 "식사 맛있게 하셨으니 이제 약 드실 시간이에요! 얼른 드시고 말씀해 주세요."

---