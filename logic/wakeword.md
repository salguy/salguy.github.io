---
layout: default
title: Wake Word 감지
nav_order: 2
---

# 🗣 Wake Word 감지 시스템

살가이 AI 스피커는 사용자의 명시적 호출("살가이")을 인식하기 위한 **Wake Word 감지 시스템**을 탑재하고 있습니다.

## 사용 엔진: Porcupine

- 오프라인 작동 가능
- 라즈베리파이에 최적화된 경량 엔진
- 커스텀 키워드("살가이") 학습 및 배포 가능

## 인식 방식

- **음성 패턴 매칭 기반**  
  사전에 등록된 "살가이" 음성 특징(주파수, 진폭 등)을 실시간으로 비교하여 인식

- **낮은 리소스 소비**  
  STT 기반 Wake Word 대비 CPU·메모리 점유율이 낮아 항상 감지 상태 유지에 유리

## 루틴 흐름
- 1. Wake Word를 인식합니다.
- 2. 사용자의 음성 응답을 LLM에서 (복약 시점 질문, 일반 대화, 모호함)의 3가지 상태로 분류합니다. (추가예정)
- 3. 분류한 상태에 따라서 알맞은 응답을 제공합니다.

## 마이크 자원 충돌 해결

Wake Word 감지와 사용자 응답 녹음을 동시에 수행하기 위해 **thread 간 마이크 권한 관리**를 구현하였습니다.

### 병렬 처리 구조

- Thread 1: Wake Word 감지 (Porcupine)
- Thread 2: 복약 알림 시 사용자 응답 녹음 (`arecord`)

둘 사이의 마이크 충돌을 방지하기 위해 `threading.Lock()`을 활용한 마이크 자원 동기화 처리 적용.

## 테스트 결과

- "살가이" 외에 유사 발음("설가이", "살가", "살가기")도 일부 인식됨
- "살개", "살고기" 등은 인식되지 않도록 정밀 튜닝
- 마이크 종류에 따라 인식률 차이 발생 (헤드셋 마이크 > 일반 외장 마이크)
